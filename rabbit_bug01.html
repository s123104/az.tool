<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯æ„›å…”å…”æ’ç­è¡¨</title>
    <link rel="icon" href="https://s123104.github.io/az.tool/img/magician-hat.png">
    <style>
        body, html {
            font-family: 'Arial', sans-serif;
            background-color: #fff0f5;
            color: #ff69b4;
            margin: 0;
            padding: 0;
            height: 100%;
            font-size: 12px;
            overflow: hidden;
        }

        .calendar-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            background-color: #ffebee;
        }

        .header {
            text-align: center;
            padding: 10px;
            background-color: #ff69b4;
            color: white;
            position: relative;
        }

        .title {
            font-size: 18px;
            font-weight: bold;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .title img {
            margin-right: 8px; /* æ·»åŠ é–“è· */
            height: 24px; /* èª¿æ•´åœ–ç‰‡é«˜åº¦ */
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
        }

        .nav-button {
            background-color: #ff1493;
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
        }

        .add-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #ff1493;
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 50%;
            font-size: 20px;
            line-height: 20px;
            cursor: pointer;
        }

        .week-view {
            display: flex;
            flex-grow: 1;
        }

        .time-scale {
            position: relative;
            width: 50px;
            background-color: #ffd1dc;
            font-size: 8px;
            text-align: right;
            border-right: 1px solid #ff69b4;
            padding-top: 50px; /* ç¢ºä¿æ™‚é–“åˆ»åº¦çš„åˆå§‹ä½ç½®èˆ‡ day-header çš„ä¸‹é‚Šç·£å°é½Š */
        }

        .time-slot {
            position: absolute;
            right: 2px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            white-space: nowrap;
        }

        .week-grid {
            display: flex;
            flex-grow: 1;
        }

        .day-column {
            flex: 1;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #ff69b4;
        }

        .day-column:last-child {
            border-right: none;
        }

        .day-header {
            text-align: center;
            padding: 5px 0;
            font-weight: bold;
            background-color: #ffd1dc;
            border-bottom: 1px solid #ff69b4;
        }

        .day-content {
            flex-grow: 1;
            position: relative;
        }

        .schedule-item {
            position: absolute;
            left: 2px;
            right: 2px;
            background-color: #ff69b4;
            color: white;
            font-size: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-around;
            border-radius: 3px;
            padding: 2px;
            text-align: center;
            cursor: pointer;
        }

        .vertical-line {
            display: inline-block;
            width: 1px;
            height: 8px;
            background-color: white;
            margin: 2px 0;
        }

        .total-hours {
            text-align: center;
            padding: 10px;
            font-weight: bold;
            background-color: #ff69b4;
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            padding-top: 60px;
        }

        .modal-content {
            background-color: #fff;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 300px;
            border-radius: 10px;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>
<body>
<div class="calendar-container">
    <div class="header">
        <h1 class="title">
            <img src="https://s123104.github.io/az.tool/img/magician-hat.png" alt="magician hat">
            å¯æ„›å…”å…”æ’ç­è¡¨
        </h1>
        <button class="add-button" id="addButton">+</button>
        <div class="navigation">
            <button class="nav-button" id="prevWeek">ä¸Šä¸€é€±</button>
            <button class="nav-button" id="nextWeek">ä¸‹ä¸€é€±</button>
        </div>
    </div>
    <div class="week-view">
        <div class="time-scale"></div>
        <div class="week-grid">
            <!-- é€™äº›å…§å®¹ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
        </div>
    </div>
    <div class="total-hours" id="totalHours">æœ¬é€±ç¸½å·¥æ™‚ï¼š0å°æ™‚</div>
</div>

<!-- æ¨¡æ…‹æ¡† -->
<div id="modal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>æ–°å¢/ä¿®æ”¹å·¥ä½œ</h2>
        <form id="scheduleForm">
            <label for="jobName">å·¥ä½œåç¨±</label>
            <input type="text" id="jobName" name="jobName" required>
            <label for="jobDate">æ—¥æœŸ</label>
            <input type="date" id="jobDate" name="jobDate" required>
            <label for="startTime">é–‹å§‹æ™‚é–“</label>
            <input type="time" id="startTime" name="startTime" required>
            <label for="endTime">çµæŸæ™‚é–“</label>
            <input type="time" id="endTime" name="endTime" required>
            <button type="submit">ä¿å­˜</button>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', (event) => {
    const prevWeekBtn = document.getElementById('prevWeek');
    const nextWeekBtn = document.getElementById('nextWeek');
    const totalHoursElement = document.getElementById('totalHours');
    const addButton = document.getElementById('addButton');
    const modal = document.getElementById('modal');
    const closeBtn = document.querySelector('.close');
    const scheduleForm = document.getElementById('scheduleForm');

    let currentWeek = new Date();
    let schedules = JSON.parse(localStorage.getItem('schedules')) || {};

    // é è¨­çš„å·¥ä½œå…§å®¹
    const defaultSchedules = {
        "2024-07-16": { jobName: "ç™¾è²¨å…¬å¸", start: "16:00", end: "22:00", color: "#ff69b4" },
        "2024-07-18": { jobName: "ç™¾è²¨å…¬å¸", start: "16:00", end: "22:00", color: "#ff69b4" },
        "2024-07-20": { jobName: "ç™¾è²¨å…¬å¸", start: "14:30", end: "22:00", color: "#ff69b4" },
        "2024-07-22": { jobName: "ç™¾è²¨å…¬å¸", start: "10:30", end: "16:30", color: "#ff69b4" },
        "2024-07-23": { jobName: "ç™¾è²¨å…¬å¸", start: "10:30", end: "16:30", color: "#ff69b4" },
        "2024-07-24": { jobName: "ç™¾è²¨å…¬å¸", start: "14:30", end: "20:30", color: "#ff69b4" }
    };

    // å°‡é è¨­å·¥ä½œå…§å®¹åˆä½µåˆ°schedulesä¸­
    schedules = { ...defaultSchedules, ...schedules };

    function updateWeek(direction) {
        currentWeek.setDate(currentWeek.getDate() + direction * 7);
        generateWeekGrid();
        updateDates();
        updateSchedule();
        updateTotalHours();
        updateTimeScale(); // æ›´æ–°æ™‚é–“åˆ»åº¦
    }

    function generateWeekGrid() {
        const weekGrid = document.querySelector('.week-grid');
        weekGrid.innerHTML = ''; // æ¸…ç©ºåŸæœ‰å…§å®¹
        for (let i = 0; i < 7; i++) {
            const dayColumn = document.createElement('div');
            dayColumn.classList.add('day-column');

            const dayHeader = document.createElement('div');
            dayHeader.classList.add('day-header');
            dayHeader.innerHTML = ['ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­', 'æ—¥'][i] + '<br>';
            dayColumn.appendChild(dayHeader);

            const dayContent = document.createElement('div');
            dayContent.classList.add('day-content');
            dayColumn.appendChild(dayContent);

            weekGrid.appendChild(dayColumn);
        }
    }

    function updateDates() {
        const dayHeaders = document.querySelectorAll('.day-header');
        for (let i = 0; i < 7; i++) {
            const date = new Date(currentWeek);
            date.setDate(date.getDate() - date.getDay() + i + 1);
            dayHeaders[i].innerHTML += `${date.getMonth() + 1}/${date.getDate()}`;
        }
    }

    function updateSchedule() {
        const dayContents = document.querySelectorAll('.day-content');
        dayContents.forEach(content => content.innerHTML = ''); // æ¸…ç©ºåŸæœ‰å…§å®¹

        const firstDayContentHeight = dayContents[0].offsetHeight;
        const totalMinutesInDay = 17 * 60; // 17 å°æ™‚

        Object.keys(schedules).forEach(dateKey => {
            const { jobName, start, end, color } = schedules[dateKey];
            const scheduleDate = new Date(dateKey);
            const weekStartDate = new Date(currentWeek);
            weekStartDate.setDate(weekStartDate.getDate() - weekStartDate.getDay() + 1);

            if (scheduleDate >= weekStartDate && scheduleDate < new Date(weekStartDate.getTime() + 7 * 24 * 60 * 60 * 1000)) {
                const dayIndex = (scheduleDate.getDay() + 6) % 7;
                const startTime = parseTime(start);
                const endTime = parseTime(end);
                const duration = (endTime - startTime) / 3600000; // è½‰æ›ç‚ºå°æ™‚
                const topPosition = ((startTime.getHours() - 7) * 60 + startTime.getMinutes()) / totalMinutesInDay * firstDayContentHeight; // å‡è¨­æ—©ä¸Š7é»é–‹å§‹
                const height = (duration * 60) / totalMinutesInDay * firstDayContentHeight; // 17å°æ™‚çš„ä¸€å¤©
                const scheduleItem = document.createElement('div');
                scheduleItem.classList.add('schedule-item');
                scheduleItem.style.top = `${topPosition}px`;
                scheduleItem.style.height = `${height}px`;
                scheduleItem.style.backgroundColor = color;
                scheduleItem.innerHTML = `ğŸ°<br>${jobName}<br>${formatTime(start)}<br><span class="vertical-line"></span><br>${formatTime(end)}`;

                const content = dayContents[dayIndex];
                content.appendChild(scheduleItem);

                scheduleItem.addEventListener('click', () => editSchedule(dateKey));
            }
        });
    }

    function updateTotalHours() {
        let totalHours = 0;
        Object.values(schedules).forEach(({ start, end }) => {
            totalHours += (parseTime(end) - parseTime(start)) / 3600000; // è½‰æ›ç‚ºå°æ™‚
        });
        totalHoursElement.textContent = `æœ¬é€±ç¸½å·¥æ™‚ï¼š${totalHours.toFixed(1)}å°æ™‚`;
    }

    function parseTime(timeStr) {
        const [hours, minutes] = timeStr.split(':').map(Number);
        return new Date(0, 0, 0, hours, minutes);
    }

    function formatTime(timeStr) {
        const [hours, minutes] = timeStr.split(':').map(Number);
        const period = hours < 12 ? 'æ—©ä¸Š' : hours < 18 ? 'ä¸‹åˆ' : 'æ™šä¸Š';
        const formattedHours = hours % 12 || 12;
        return `${period} ${formattedHours}:${minutes.toString().padStart(2, '0')}`;
    }

    function generateColor(jobName) {
        const colors = ['#ffc0cb', '#ffb6c1', '#ff69b4', '#ff1493', '#db7093'];
        const index = Array.from(jobName).reduce((sum, char) => sum + char.charCodeAt(0), 0) % colors.length;
        return colors[index];
    }

    function editSchedule(dateKey) {
        const { jobName, start, end } = schedules[dateKey];
        document.getElementById('jobName').value = jobName;
        document.getElementById('jobDate').value = dateKey;
        document.getElementById('startTime').value = start;
        document.getElementById('endTime').value = end;
        showModal();
        scheduleForm.onsubmit = (e) => {
            e.preventDefault();
            delete schedules[dateKey];
            saveSchedule();
        };
    }

    function saveSchedule() {
        const jobName = document.getElementById('jobName').value;
        const jobDate = document.getElementById('jobDate').value;
        const startTime = document.getElementById('startTime').value;
        const endTime = document.getElementById('endTime').value;
        const color = generateColor(jobName);

        schedules[jobDate] = { jobName, start: startTime, end: endTime, color };
        localStorage.setItem('schedules', JSON.stringify(schedules));
        closeModal();
        updateSchedule();
        updateTotalHours();
    }

    function showModal() {
        modal.style.display = 'block';
    }

    function closeModal() {
        modal.style.display = 'none';
    }

    addButton.addEventListener('click', () => {
        showModal();
        scheduleForm.onsubmit = (e) => {
            e.preventDefault();
            saveSchedule();
        };
    });

    closeBtn.addEventListener('click', closeModal);

    window.addEventListener('click', (event) => {
        if (event.target == modal) {
            closeModal();
        }
    });

    prevWeekBtn.addEventListener('click', () => updateWeek(-1));
    nextWeekBtn.addEventListener('click', () => updateWeek(1));

    function updateTimeScale() {
        const timeScale = document.querySelector('.time-scale');
        timeScale.innerHTML = ''; // æ¸…ç©ºåŸæœ‰å…§å®¹

        const firstDayContentHeight = document.querySelector('.day-content').offsetHeight;
        const totalMinutesInDay = 17 * 60; // 17 å°æ™‚
        const headerHeight = document.querySelector('.day-header').offsetHeight; // ç²å– day-header çš„é«˜åº¦
        const timeIntervals = [
            "æ—©ä¸Š7:00","æ—©ä¸Š8:00", "æ—©ä¸Š9:00", "ä¸Šåˆ10:00", "ä¸Šåˆ11:00", "ä¸­åˆ12:00",
"ä¸‹åˆ1:00", "ä¸‹åˆ2:00", "ä¸‹åˆ3:00", "ä¸‹åˆ4:00", "ä¸‹åˆ5:00", "æ™šä¸Š6:00",
"æ™šä¸Š7:00", "æ™šä¸Š8:00", "æ™šä¸Š9:00", "æ™šä¸Š10:00", "æ™šä¸Š11:00", "æ™šä¸Š12:00"
];
timeIntervals.forEach((time, index) => {
        const timeSlot = document.createElement('div');
        timeSlot.classList.add('time-slot');
        const topPosition = (index / (timeIntervals.length - 1)) * (firstDayContentHeight) + headerHeight;
        timeSlot.style.top = `${topPosition}px`;
        timeSlot.innerHTML = time;
        timeScale.appendChild(timeSlot);
    });
}

generateWeekGrid();
updateDates();
updateSchedule();
updateTotalHours();
updateTimeScale(); // åˆå§‹åŒ–æ™‚é–“åˆ»åº¦
});
</script>
</body>
</html>
