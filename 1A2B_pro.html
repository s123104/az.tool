<!DOCTYPE html>

<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <title>1A2B é€²éšæ•¸å­—çŒœè¬éŠæˆ²</title>


<!-- PWA Meta Tags -->
<meta name="theme-color" content="#6366f1">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ®</text></svg>">

<!-- SEO & Open Graph -->
<meta name="description" content="æœ€ç²¾ç·»çš„1A2Bæ•¸å­—çŒœè¬éŠæˆ²ï¼Œæ”¯æ´é»æ•¸ç³»çµ±ã€æˆå°±è§£é–å’Œå…’ç«¥æ¨¡å¼">
<meta property="og:title" content="1A2B é€²éšæ•¸å­—çŒœè¬éŠæˆ²">
<meta property="og:description" content="æœ€ç²¾ç·»çš„1A2Bæ•¸å­—çŒœè¬éŠæˆ²ï¼Œæ”¯æ´é»æ•¸ç³»çµ±ã€æˆå°±è§£é–å’Œå…’ç«¥æ¨¡å¼">
<meta property="og:type" content="website">

<!-- CDN Resources -->
<script src="https://cdn.tailwindcss.com"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<!-- Tailwind Config -->
<script>
    tailwind.config = {
        darkMode: 'class',
        theme: {
            extend: {
                fontFamily: {
                    'sans': ['Inter', 'Noto Sans TC', 'sans-serif'],
                },
                colors: {
                    primary: {
                        50: '#eff6ff',
                        100: '#dbeafe',
                        200: '#bfdbfe',
                        300: '#93c5fd',
                        400: '#60a5fa',
                        500: '#3b82f6',
                        600: '#2563eb',
                        700: '#1d4ed8',
                        800: '#1e40af',
                        900: '#1e3a8a',
                    },
                    secondary: {
                        50: '#fdf2f8',
                        100: '#fce7f3',
                        200: '#fbcfe8',
                        300: '#f9a8d4',
                        400: '#f472b6',
                        500: '#ec4899',
                        600: '#db2777',
                        700: '#be185d',
                        800: '#9d174d',
                        900: '#831843',
                    },
                    success: '#10b981',
                    warning: '#f59e0b',
                    error: '#ef4444',
                },
                spacing: {
                    '18': '4.5rem',
                    '88': '22rem',
                    'safe-bottom': 'env(safe-area-inset-bottom)',
                    'safe-top': 'env(safe-area-inset-top)',
                },
                animation: {
                    'bounce-gentle': 'bounce-gentle 2s infinite',
                    'pulse-glow': 'pulse-glow 2s infinite',
                    'slide-in': 'slide-in 0.3s ease-out',
                    'number-pop': 'number-pop 0.2s ease-out',
                },
                keyframes: {
                    'bounce-gentle': {
                        '0%, 100%': { transform: 'translateY(0)' },
                        '50%': { transform: 'translateY(-4px)' },
                    },
                    'pulse-glow': {
                        '0%, 100%': { boxShadow: '0 0 20px rgba(59, 130, 246, 0.5)' },
                        '50%': { boxShadow: '0 0 30px rgba(59, 130, 246, 0.8)' },
                    },
                    'slide-in': {
                        '0%': { opacity: '0', transform: 'translateY(10px)' },
                        '100%': { opacity: '1', transform: 'translateY(0)' },
                    },
                    'number-pop': {
                        '0%': { transform: 'scale(1)' },
                        '50%': { transform: 'scale(1.1)' },
                        '100%': { transform: 'scale(1)' },
                    },
                },
            },
        },
    }
</script>

<!-- Custom Styles -->
<style>
    /* iOS Safe Area Support */
    body {
        padding-top: env(safe-area-inset-top);
        padding-bottom: env(safe-area-inset-bottom);
        padding-left: env(safe-area-inset-left);
        padding-right: env(safe-area-inset-right);
    }
    
    /* Touch Optimizations */
    * {
        -webkit-tap-highlight-color: transparent;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }
    
    input {
        -webkit-user-select: text;
        -moz-user-select: text;
        -ms-user-select: text;
        user-select: text;
    }
    
    /* Scrollbar Styling */
    .chat-body::-webkit-scrollbar {
        width: 6px;
    }
    
    .chat-body::-webkit-scrollbar-track {
        background: transparent;
    }
    
    .chat-body::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 3px;
    }
    
    /* Children Mode Styles */
    .children-mode .number-button {
        font-size: 1.5rem;
        padding: 1rem;
    }
    
    .children-mode .result-a {
        background: linear-gradient(45deg, #10b981, #34d399);
        color: white;
        padding: 0.5rem;
        border-radius: 0.5rem;
        font-weight: bold;
    }
    
    .children-mode .result-b {
        background: linear-gradient(45deg, #f59e0b, #fbbf24);
        color: white;
        padding: 0.5rem;
        border-radius: 0.5rem;
        font-weight: bold;
    }
    
    /* Particle Effects */
    @keyframes particle-float {
        0% { transform: translateY(0) rotate(0deg); opacity: 1; }
        100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
    }
    
    .particle {
        position: absolute;
        pointer-events: none;
        animation: particle-float 2s ease-out forwards;
    }
    
    /* CRT Filter for Shake Easter Egg */
    .crt-filter {
        filter: contrast(1.2) brightness(1.1) hue-rotate(10deg);
        animation: crt-flicker 0.1s infinite alternate;
    }
    
    @keyframes crt-flicker {
        0% { filter: contrast(1.2) brightness(1.1) hue-rotate(10deg); }
        100% { filter: contrast(1.3) brightness(1.2) hue-rotate(15deg); }
    }
</style>


</head>

<body class="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50 font-sans overflow-hidden">
    <!-- Hidden Easter Egg Button -->
    <button id="easterEggBtn" class="fixed top-4 left-4 opacity-0 w-8 h-8 bg-primary-500 rounded-full z-50"></button>


<!-- Game Container -->
<div class="flex flex-col h-screen max-w-md mx-auto bg-white shadow-2xl relative">
    <!-- Header -->
    <header class="bg-gradient-to-r from-primary-600 to-secondary-600 text-white p-4 pt-8 shadow-lg relative">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
                    <i class="fas fa-gamepad text-xl"></i>
                </div>
                <div>
                    <h1 class="text-lg font-bold">1A2B çŒœæ•¸å­—</h1>
                    <p class="text-xs opacity-90" id="levelDisplay">ç­‰ç´š 1 - æ–°æ‰‹</p>
                </div>
            </div>
            
            <!-- Settings & Mode Toggle -->
            <div class="flex items-center space-x-2">
                <button id="childrenModeBtn" class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center transition-all duration-200 hover:bg-white/30">
                    <i class="fas fa-child text-lg"></i>
                </button>
                <button id="achievementBtn" class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center transition-all duration-200 hover:bg-white/30 relative">
                    <i class="fas fa-trophy text-lg"></i>
                    <span id="newAchievementBadge" class="absolute -top-1 -right-1 w-3 h-3 bg-warning rounded-full hidden"></span>
                </button>
            </div>
        </div>
        
        <!-- Stats Bar -->
        <div class="mt-4 grid grid-cols-3 gap-4 text-center">
            <div class="bg-white/20 rounded-lg p-2">
                <div class="text-xs opacity-90">ç¸½åˆ†</div>
                <div class="font-bold" id="totalScore">0</div>
            </div>
            <div class="bg-white/20 rounded-lg p-2">
                <div class="text-xs opacity-90">ç¶“é©—å€¼</div>
                <div class="font-bold" id="currentExp">0</div>
            </div>
            <div class="bg-white/20 rounded-lg p-2">
                <div class="text-xs opacity-90">é€£å‹</div>
                <div class="font-bold" id="winStreak">0</div>
            </div>
        </div>
        
        <!-- Experience Bar -->
        <div class="mt-3">
            <div class="bg-white/20 rounded-full h-2 overflow-hidden">
                <div id="expBar" class="bg-warning h-full transition-all duration-500" style="width: 0%"></div>
            </div>
        </div>
    </header>

    <!-- Chat Area -->
    <div class="flex-1 overflow-y-auto p-4 space-y-3 chat-body" id="chatBody">
        <!-- Messages will be inserted here -->
    </div>

    <!-- Input Area with Safe Bottom Padding -->
    <div class="p-4 bg-gray-50 border-t" style="padding-bottom: calc(1rem + env(safe-area-inset-bottom));">
        <!-- Guess Display -->
        <div class="mb-4">
            <div class="bg-white rounded-xl p-4 border-2 border-gray-200 text-center">
                <div class="text-sm text-gray-600 mb-2">ä½ çš„çŒœæ¸¬</div>
                <div id="guessDisplay" class="text-2xl font-bold text-gray-800 tracking-widest min-h-8">----</div>
            </div>
        </div>
        
        <!-- Number Pad -->
        <div class="grid grid-cols-3 gap-3 mb-4" id="numberPad">
            <!-- Number buttons will be generated by JS -->
        </div>
        
        <!-- Action Buttons -->
        <div class="grid grid-cols-2 gap-3">
            <button id="clearBtn" class="bg-gray-500 text-white py-3 rounded-xl font-medium transition-all duration-200 hover:bg-gray-600 active:scale-95">
                <i class="fas fa-backspace mr-2"></i>æ¸…é™¤
            </button>
            <button id="submitBtn" class="bg-primary-500 text-white py-3 rounded-xl font-medium transition-all duration-200 hover:bg-primary-600 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed">
                <i class="fas fa-paper-plane mr-2"></i>æäº¤
            </button>
        </div>
    </div>
</div>

<!-- Achievement Modal -->
<div id="achievementModal" class="fixed inset-0 bg-black/50 hidden z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl p-6 max-w-sm w-full max-h-96 overflow-y-auto">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-xl font-bold text-gray-800">ğŸ† æˆå°±ç³»çµ±</h3>
            <button id="closeAchievementModal" class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center">
                <i class="fas fa-times text-gray-600"></i>
            </button>
        </div>
        <div id="achievementList" class="space-y-3">
            <!-- Achievements will be populated here -->
        </div>
    </div>
</div>

<!-- New Achievement Notification -->
<div id="achievementNotification" class="fixed top-20 left-1/2 transform -translate-x-1/2 bg-gradient-to-r from-warning to-secondary-500 text-white px-6 py-3 rounded-full shadow-lg hidden z-50 animate-slide-in">
    <div class="flex items-center space-x-2">
        <i class="fas fa-trophy"></i>
        <span id="achievementText">æ–°æˆå°±è§£é–ï¼</span>
    </div>
</div>

<!-- Web App Manifest -->
<script type="application/manifest+json">
{
    "name": "1A2B é€²éšæ•¸å­—çŒœè¬éŠæˆ²",
    "short_name": "1A2B Game",
    "description": "æœ€ç²¾ç·»çš„1A2Bæ•¸å­—çŒœè¬éŠæˆ²",
    "start_url": "/",
    "display": "standalone",
    "background_color": "#ffffff",
    "theme_color": "#6366f1",
    "icons": [
        {
            "src": "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ®</text></svg>",
            "sizes": "192x192",
            "type": "image/svg+xml"
        }
    ]
}
</script>

<script>
    // ==================== éŠæˆ²ç‹€æ…‹ç®¡ç† ====================
    class Game1A2B {
        constructor() {
            this.secretNumber = '';
            this.currentGuess = '';
            this.attempts = 0;
            this.gameHistory = [];
            this.isChildrenMode = false;
            this.score = this.loadData('totalScore', 0);
            this.experience = this.loadData('experience', 0);
            this.level = this.loadData('level', 1);
            this.winStreak = this.loadData('winStreak', 0);
            this.achievements = this.loadData('achievements', []);
            this.gamesPlayed = this.loadData('gamesPlayed', 0);
            
            this.initializeGame();
            this.setupEventListeners();
            this.setupEasterEggs();
            this.updateDisplay();
            this.checkAchievements();
        }

        // ==================== æ•¸æ“šæŒä¹…åŒ– ====================
        saveData(key, value) {
            try {
                localStorage.setItem(`1a2b_${key}`, JSON.stringify(value));
            } catch (e) {
                console.warn('ç„¡æ³•ä¿å­˜æ•¸æ“šåˆ°æœ¬åœ°å­˜å„²');
            }
        }

        loadData(key, defaultValue) {
            try {
                const stored = localStorage.getItem(`1a2b_${key}`);
                return stored ? JSON.parse(stored) : defaultValue;
            } catch (e) {
                return defaultValue;
            }
        }

        // ==================== éŠæˆ²åˆå§‹åŒ– ====================
        initializeGame() {
            this.generateSecretNumber();
            this.attempts = 0;
            this.gameHistory = [];
            this.currentGuess = '';
            this.createNumberPad();
            this.addWelcomeMessage();
            this.gamesPlayed++;
            this.saveData('gamesPlayed', this.gamesPlayed);
        }

        generateSecretNumber() {
            const digits = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9];
            this.secretNumber = '';
            for (let i = 0; i < 4; i++) {
                const index = Math.floor(Math.random() * digits.length);
                this.secretNumber += digits[index];
                digits.splice(index, 1);
            }
            console.log('Secret number generated:', this.secretNumber); // For debugging
        }

        createNumberPad() {
            const numberPad = document.getElementById('numberPad');
            numberPad.innerHTML = '';
            
            // Create number buttons 1-9, 0
            const layout = [
                [1, 2, 3],
                [4, 5, 6], 
                [7, 8, 9],
                ['âŒ«', 0, 'âœ“']
            ];

            layout.forEach(row => {
                row.forEach(item => {
                    const button = document.createElement('button');
                    button.className = `number-button bg-white border-2 border-gray-200 rounded-xl py-4 text-xl font-semibold transition-all duration-200 hover:bg-gray-50 active:scale-95 ${this.isChildrenMode ? 'text-2xl py-5' : ''}`;
                    
                    if (typeof item === 'number') {
                        button.textContent = item;
                        button.onclick = () => this.addNumber(item);
                    } else if (item === 'âŒ«') {
                        button.innerHTML = '<i class="fas fa-backspace"></i>';
                        button.onclick = () => this.removeLastNumber();
                        button.className += ' text-gray-600';
                    } else if (item === 'âœ“') {
                        button.innerHTML = '<i class="fas fa-check"></i>';
                        button.onclick = () => this.submitGuess();
                        button.className += ' bg-primary-500 text-white hover:bg-primary-600';
                    }
                    
                    numberPad.appendChild(button);
                });
            });

            this.updateNumberPadState();
        }

        // ==================== è¼¸å…¥è™•ç† ====================
        addNumber(number) {
            if (this.currentGuess.length < 4 && !this.currentGuess.includes(number.toString())) {
                this.currentGuess += number;
                this.updateGuessDisplay();
                this.updateNumberPadState();
                
                // Number pop animation
                this.animateNumberInput(number);
                
                // Auto submit when 4 digits entered
                if (this.currentGuess.length === 4) {
                    setTimeout(() => this.submitGuess(), 300);
                }
            }
        }

        removeLastNumber() {
            if (this.currentGuess.length > 0) {
                this.currentGuess = this.currentGuess.slice(0, -1);
                this.updateGuessDisplay();
                this.updateNumberPadState();
            }
        }

        clearGuess() {
            this.currentGuess = '';
            this.updateGuessDisplay();
            this.updateNumberPadState();
        }

        updateGuessDisplay() {
            const display = document.getElementById('guessDisplay');
            const displayText = this.currentGuess.padEnd(4, '-');
            display.textContent = displayText.split('').join(' ');
        }

        updateNumberPadState() {
            const buttons = document.querySelectorAll('.number-button');
            buttons.forEach(button => {
                const text = button.textContent.trim();
                if (!isNaN(text) && text !== '') {
                    const number = parseInt(text);
                    if (this.currentGuess.includes(number.toString())) {
                        button.className = button.className.replace('bg-white border-gray-200', 'bg-gray-300 border-gray-400');
                        button.disabled = true;
                    } else {
                        button.className = button.className.replace('bg-gray-300 border-gray-400', 'bg-white border-gray-200');
                        button.disabled = false;
                    }
                }
            });

            // Update submit button state
            const submitBtn = document.getElementById('submitBtn');
            if (this.currentGuess.length === 4) {
                submitBtn.disabled = false;
                submitBtn.className = submitBtn.className.replace('disabled:opacity-50 disabled:cursor-not-allowed', '');
            } else {
                submitBtn.disabled = true;
            }
        }

        // ==================== éŠæˆ²é‚è¼¯ ====================
        submitGuess() {
            if (this.currentGuess.length !== 4) {
                this.addMessage('è«‹è¼¸å…¥å®Œæ•´çš„4ä½æ•¸å­—ï¼', false, 'warning');
                return;
            }

            // Check for duplicate digits
            if (new Set(this.currentGuess).size !== 4) {
                this.addMessage('è«‹è¼¸å…¥4å€‹ä¸é‡è¤‡çš„æ•¸å­—ï¼', false, 'warning');
                this.clearGuess();
                return;
            }

            this.attempts++;
            this.addMessage(this.currentGuess, true);

            const result = this.calculateResult(this.currentGuess, this.secretNumber);
            this.gameHistory.push({
                guess: this.currentGuess,
                result: result,
                attempt: this.attempts
            });

            if (result.a === 4) {
                this.handleWin();
            } else {
                this.addResultMessage(result);
                this.clearGuess();
            }
        }

        calculateResult(guess, secret) {
            let a = 0, b = 0;
            for (let i = 0; i < 4; i++) {
                if (guess[i] === secret[i]) {
                    a++;
                } else if (secret.includes(guess[i])) {
                    b++;
                }
            }
            return { a, b };
        }

        handleWin() {
            const baseScore = Math.max(100 - (this.attempts - 1) * 10, 10);
            const levelBonus = this.level * 5;
            const gameScore = baseScore + levelBonus;
            
            this.score += gameScore;
            this.experience += gameScore;
            this.winStreak++;
            
            // Level up check
            const newLevel = Math.floor(this.experience / 500) + 1;
            if (newLevel > this.level) {
                this.level = newLevel;
                this.showLevelUp();
            }

            this.addMessage(`ğŸ‰ æ­å–œï¼ä½ çŒœå°äº†ï¼ç­”æ¡ˆæ˜¯ ${this.secretNumber}`, false, 'success');
            this.addMessage(`ğŸ† ç²å¾— ${gameScore} åˆ†ï¼(åŸºç¤åˆ†: ${baseScore}, ç­‰ç´šçå‹µ: ${levelBonus})`, false, 'success');
            
            this.saveAllData();
            this.updateDisplay();
            this.checkAchievements();
            this.createParticleEffect();
            
            setTimeout(() => {
                this.addMessage('ğŸ® æ–°éŠæˆ²å³å°‡é–‹å§‹...', false);
                setTimeout(() => this.initializeGame(), 2000);
            }, 3000);
        }

        addResultMessage(result) {
            if (this.isChildrenMode) {
                // Children mode with detailed explanation
                let message = '<div class="space-y-2">';
                message += `<div class="text-lg">ç¬¬ ${this.attempts} æ¬¡çŒœæ¸¬çµæœï¼š</div>`;
                
                if (result.a > 0) {
                    message += `<div class="result-a">âœ… ${result.a}A - æœ‰ ${result.a} å€‹æ•¸å­—ä½ç½®å®Œå…¨æ­£ç¢ºï¼</div>`;
                }
                
                if (result.b > 0) {
                    message += `<div class="result-b">ğŸ”¶ ${result.b}B - æœ‰ ${result.b} å€‹æ•¸å­—å­˜åœ¨ä½†ä½ç½®ä¸å°ï¼</div>`;
                }
                
                if (result.a === 0 && result.b === 0) {
                    message += '<div class="bg-gray-200 p-3 rounded-lg">âŒ 0A0B - é€™4å€‹æ•¸å­—éƒ½ä¸åœ¨ç­”æ¡ˆä¸­å–”ï¼</div>';
                }
                
                message += '</div>';
                this.addMessage(message, false);
            } else {
                // Normal mode
                const resultText = `<span class="font-bold text-2xl">
                    <span class="text-success">${result.a}A</span>
                    <span class="text-warning">${result.b}B</span>
                </span>`;
                this.addMessage(`ç¬¬ ${this.attempts} æ¬¡ï¼š${resultText}`, false);
            }

            // Hint system for beginners
            if (this.attempts >= 5 && this.level === 1) {
                this.addMessage('ğŸ’¡ å°æç¤ºï¼šAè¡¨ç¤ºæ•¸å­—å’Œä½ç½®éƒ½å°ï¼ŒBè¡¨ç¤ºæ•¸å­—å°ä½†ä½ç½®ä¸å°', false, 'info');
            }
        }

        // ==================== æ¶ˆæ¯ç³»çµ± ====================
        addMessage(content, isUser = false, type = 'normal') {
            const chatBody = document.getElementById('chatBody');
            const messageDiv = document.createElement('div');
            
            let bgColor = isUser ? 'bg-primary-500 text-white' : 'bg-white';
            let alignment = isUser ? 'ml-auto' : 'mr-auto';
            
            if (!isUser) {
                switch (type) {
                    case 'success': bgColor = 'bg-green-100 border-green-300 text-green-800'; break;
                    case 'warning': bgColor = 'bg-yellow-100 border-yellow-300 text-yellow-800'; break;
                    case 'info': bgColor = 'bg-blue-100 border-blue-300 text-blue-800'; break;
                }
            }

            messageDiv.className = `max-w-xs p-3 rounded-2xl shadow-md animate-slide-in ${bgColor} ${alignment} ${type !== 'normal' ? 'border-2' : ''}`;
            messageDiv.innerHTML = content;
            
            chatBody.appendChild(messageDiv);
            chatBody.scrollTop = chatBody.scrollHeight;
        }

        addWelcomeMessage() {
            const welcomeMessages = [
                'ğŸ® æ­¡è¿ä¾†åˆ°1A2Bæ•¸å­—çŒœè¬éŠæˆ²ï¼',
                'ğŸ¯ æˆ‘å·²ç¶“æƒ³å¥½ä¸€å€‹4ä½ä¸é‡è¤‡æ•¸å­—',
                'ğŸ§  Aè¡¨ç¤ºæ•¸å­—å’Œä½ç½®éƒ½æ­£ç¢ºï¼ŒBè¡¨ç¤ºæ•¸å­—æ­£ç¢ºä½†ä½ç½®éŒ¯èª¤',
                'ğŸ† å®ŒæˆéŠæˆ²å¯ç²å¾—ç¶“é©—å€¼å’Œæˆå°±ï¼',
                'é–‹å§‹çŒœæ¸¬å§ï¼'
            ];

            welcomeMessages.forEach((msg, index) => {
                setTimeout(() => this.addMessage(msg, false, index === 0 ? 'success' : 'normal'), index * 800);
            });
        }

        // ==================== ç­‰ç´šèˆ‡æˆå°±ç³»çµ± ====================
        updateDisplay() {
            document.getElementById('totalScore').textContent = this.score.toLocaleString();
            document.getElementById('currentExp').textContent = this.experience.toLocaleString();
            document.getElementById('winStreak').textContent = this.winStreak;
            document.getElementById('levelDisplay').textContent = `ç­‰ç´š ${this.level} - ${this.getLevelName()}`;
            
            // Update experience bar
            const expBar = document.getElementById('expBar');
            const expInLevel = this.experience % 500;
            const expPercentage = (expInLevel / 500) * 100;
            expBar.style.width = `${expPercentage}%`;
        }

        getLevelName() {
            const levelNames = [
                'æ–°æ‰‹', 'å­¸å¾’', 'ç†Ÿç·´', 'å°ˆå®¶', 'å¤§å¸«', 'å®—å¸«', 'å‚³èªª', 'ç¥è©±', 'è‡³å°Š', 'ç„¡æ•µ'
            ];
            return levelNames[Math.min(this.level - 1, levelNames.length - 1)] || 'è¶…è¶Šæ¥µé™';
        }

        showLevelUp() {
            this.addMessage(`ğŸŠ æ­å–œå‡ç´šï¼ç¾åœ¨æ˜¯ç­‰ç´š ${this.level} - ${this.getLevelName()}ï¼`, false, 'success');
            this.createParticleEffect('ğŸŒŸ');
        }

        saveAllData() {
            this.saveData('totalScore', this.score);
            this.saveData('experience', this.experience);
            this.saveData('level', this.level);
            this.saveData('winStreak', this.winStreak);
            this.saveData('achievements', this.achievements);
        }

        // ==================== æˆå°±ç³»çµ± ====================
        checkAchievements() {
            const achievementDefinitions = [
                { id: 'first_win', name: 'é¦–æ¬¡å‹åˆ©', description: 'å®Œæˆç¬¬ä¸€å±€éŠæˆ²', icon: 'ğŸ', condition: () => this.gamesPlayed >= 1 },
                { id: 'quick_solver', name: 'ç¥ç®—å­', description: '3æ¬¡å…§çŒœä¸­ç­”æ¡ˆ', icon: 'ğŸ§ ', condition: () => this.gameHistory.length > 0 && this.attempts <= 3 },
                { id: 'persistent', name: 'å …æŒä¸æ‡ˆ', description: 'å®Œæˆ10å±€éŠæˆ²', icon: 'ğŸ’ª', condition: () => this.gamesPlayed >= 10 },
                { id: 'level_5', name: 'é€²éšç©å®¶', description: 'é”åˆ°ç­‰ç´š5', icon: 'â­', condition: () => this.level >= 5 },
                { id: 'score_1000', name: 'åƒåˆ†é”äºº', description: 'ç¸½åˆ†é”åˆ°1000åˆ†', icon: 'ğŸ’¯', condition: () => this.score >= 1000 },
                { id: 'win_streak_5', name: 'é€£å‹ç‹', description: 'é€£çºŒå‹åˆ©5æ¬¡', icon: 'ğŸ”¥', condition: () => this.winStreak >= 5 },
                { id: 'score_10000', name: 'è¬åˆ†é«˜æ‰‹', description: 'ç¸½åˆ†é”åˆ°10000åˆ†', icon: 'ğŸ‘‘', condition: () => this.score >= 10000 },
                { id: 'level_10', name: 'å¤§å¸«ç´šåˆ¥', description: 'é”åˆ°ç­‰ç´š10', icon: 'ğŸ†', condition: () => this.level >= 10 },
                { id: 'score_100000', name: 'åè¬å·¨æ˜Ÿ', description: 'ç¸½åˆ†é”åˆ°100000åˆ†', icon: 'ğŸŒŸ', condition: () => this.score >= 100000 },
            ];

            achievementDefinitions.forEach(achievement => {
                if (!this.achievements.includes(achievement.id) && achievement.condition()) {
                    this.unlockAchievement(achievement);
                }
            });
        }

        unlockAchievement(achievement) {
            this.achievements.push(achievement.id);
            this.saveData('achievements', this.achievements);
            this.showAchievementNotification(achievement);
            
            // Show new achievement badge
            document.getElementById('newAchievementBadge').classList.remove('hidden');
        }

        showAchievementNotification(achievement) {
            const notification = document.getElementById('achievementNotification');
            const text = document.getElementById('achievementText');
            text.textContent = `${achievement.icon} ${achievement.name}`;
            
            notification.classList.remove('hidden');
            setTimeout(() => {
                notification.classList.add('hidden');
            }, 3000);
        }

        // ==================== å…’ç«¥æ¨¡å¼ ====================
        toggleChildrenMode() {
            this.isChildrenMode = !this.isChildrenMode;
            const body = document.body;
            const btn = document.getElementById('childrenModeBtn');
            
            if (this.isChildrenMode) {
                body.classList.add('children-mode');
                btn.innerHTML = '<i class="fas fa-child text-yellow-300"></i>';
                this.addMessage('ğŸ¨ å·²åˆ‡æ›åˆ°å…’ç«¥æ¨¡å¼ï¼æ›´æ¸…æ¥šçš„çµæœèªªæ˜', false, 'info');
            } else {
                body.classList.remove('children-mode');
                btn.innerHTML = '<i class="fas fa-child"></i>';
                this.addMessage('ğŸ’¼ å·²åˆ‡æ›åˆ°æ™®é€šæ¨¡å¼', false, 'info');
            }
            
            this.createNumberPad();
            this.saveData('childrenMode', this.isChildrenMode);
        }

        // ==================== å‹•ç•«æ•ˆæœ ====================
        animateNumberInput(number) {
            const buttons = document.querySelectorAll('.number-button');
            buttons.forEach(button => {
                if (button.textContent.trim() === number.toString()) {
                    button.classList.add('animate-number-pop');
                    setTimeout(() => button.classList.remove('animate-number-pop'), 200);
                }
            });
        }

        createParticleEffect(emoji = 'ğŸ‰') {
            const container = document.querySelector('.game-container');
            for (let i = 0; i < 15; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.left = Math.random() * 100 + '%';
                    particle.style.fontSize = (Math.random() * 20 + 15) + 'px';
                    particle.textContent = emoji;
                    container.appendChild(particle);
                    
                    setTimeout(() => particle.remove(), 2000);
                }, i * 100);
            }
        }

        // ==================== äº‹ä»¶ç›£è½å™¨ ====================
        setupEventListeners() {
            // Clear button
            document.getElementById('clearBtn').onclick = () => this.clearGuess();
            
            // Submit button  
            document.getElementById('submitBtn').onclick = () => this.submitGuess();
            
            // Children mode toggle
            document.getElementById('childrenModeBtn').onclick = () => this.toggleChildrenMode();
            
            // Achievement modal
            document.getElementById('achievementBtn').onclick = () => this.showAchievementModal();
            document.getElementById('closeAchievementModal').onclick = () => this.hideAchievementModal();
            
            // Keyboard support
            document.addEventListener('keydown', (e) => {
                if (e.key >= '0' && e.key <= '9') {
                    this.addNumber(parseInt(e.key));
                } else if (e.key === 'Backspace') {
                    this.removeLastNumber();
                } else if (e.key === 'Enter') {
                    this.submitGuess();
                } else if (e.key === 'Escape') {
                    this.clearGuess();
                }
            });
            
            // Load saved children mode
            const savedChildrenMode = this.loadData('childrenMode', false);
            if (savedChildrenMode) {
                this.toggleChildrenMode();
            }
        }

        showAchievementModal() {
            const modal = document.getElementById('achievementModal');
            const list = document.getElementById('achievementList');
            
            // Hide new achievement badge
            document.getElementById('newAchievementBadge').classList.add('hidden');
            
            // Achievement definitions for display
            const allAchievements = [
                { id: 'first_win', name: 'é¦–æ¬¡å‹åˆ©', description: 'å®Œæˆç¬¬ä¸€å±€éŠæˆ²', icon: 'ğŸ' },
                { id: 'quick_solver', name: 'ç¥ç®—å­', description: '3æ¬¡å…§çŒœä¸­ç­”æ¡ˆ', icon: 'ğŸ§ ' },
                { id: 'persistent', name: 'å …æŒä¸æ‡ˆ', description: 'å®Œæˆ10å±€éŠæˆ²', icon: 'ğŸ’ª' },
                { id: 'level_5', name: 'é€²éšç©å®¶', description: 'é”åˆ°ç­‰ç´š5', icon: 'â­' },
                { id: 'score_1000', name: 'åƒåˆ†é”äºº', description: 'ç¸½åˆ†é”åˆ°1000åˆ†', icon: 'ğŸ’¯' },
                { id: 'win_streak_5', name: 'é€£å‹ç‹', description: 'é€£çºŒå‹åˆ©5æ¬¡', icon: 'ğŸ”¥' },
                { id: 'score_10000', name: 'è¬åˆ†é«˜æ‰‹', description: 'ç¸½åˆ†é”åˆ°10000åˆ†', icon: 'ğŸ‘‘' },
                { id: 'level_10', name: 'å¤§å¸«ç´šåˆ¥', description: 'é”åˆ°ç­‰ç´š10', icon: 'ğŸ†' },
                { id: 'score_100000', name: 'åè¬å·¨æ˜Ÿ', description: 'ç¸½åˆ†é”åˆ°100000åˆ†', icon: 'ğŸŒŸ' },
            ];
            
            list.innerHTML = allAchievements.map(achievement => {
                const unlocked = this.achievements.includes(achievement.id);
                return `
                    <div class="flex items-center space-x-3 p-3 rounded-lg ${unlocked ? 'bg-green-50 border border-green-200' : 'bg-gray-50 border border-gray-200'}">
                        <div class="text-2xl ${unlocked ? '' : 'grayscale opacity-50'}">${achievement.icon}</div>
                        <div class="flex-1">
                            <div class="font-semibold ${unlocked ? 'text-green-800' : 'text-gray-600'}">${achievement.name}</div>
                            <div class="text-sm ${unlocked ? 'text-green-600' : 'text-gray-500'}">${achievement.description}</div>
                        </div>
                        ${unlocked ? '<i class="fas fa-check text-green-500"></i>' : '<i class="fas fa-lock text-gray-400"></i>'}
                    </div>
                `;
            }).join('');
            
            modal.classList.remove('hidden');
        }

        hideAchievementModal() {
            document.getElementById('achievementModal').classList.add('hidden');
        }

        // ==================== å½©è›‹åŠŸèƒ½ ====================
        setupEasterEggs() {
            // Konami Code Easter Egg
            this.setupKonamiCode();
            
            // Long Press Logo Easter Egg
            this.setupLongPressEasterEgg();
            
            // Shake Detection Easter Egg
            this.setupShakeDetection();
            
            // Time-based Easter Eggs
            this.setupTimeBasedEasterEggs();
            
            // Keyboard Combo Easter Egg
            this.setupKeyboardCombo();
            
            // Hidden Button Easter Egg
            this.setupHiddenButton();
        }

        setupKonamiCode() {
            const konamiCode = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'KeyB', 'KeyA'];
            let konamiIndex = 0;
            
            document.addEventListener('keydown', (e) => {
                if (e.code === konamiCode[konamiIndex]) {
                    konamiIndex++;
                    if (konamiIndex === konamiCode.length) {
                        this.triggerKonamiEasterEgg();
                        konamiIndex = 0;
                    }
                } else {
                    konamiIndex = 0;
                }
            });
        }

        triggerKonamiEasterEgg() {
            this.addMessage('ğŸ® Konami Code å•Ÿå‹•ï¼ç²å¾—8-bitå¾½ç« ï¼', false, 'success');
            this.score += 500;
            this.updateDisplay();
            this.createParticleEffect('ğŸ•¹ï¸');
            
            // Play retro sound effect (if supported)
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                oscillator.type = 'square';
                oscillator.frequency.value = 440;
                oscillator.connect(audioContext.destination);
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.2);
            } catch (e) {
                console.log('Audio not supported');
            }
        }

        setupLongPressEasterEgg() {
            const logo = document.querySelector('.chat-header h1');
            let pressTimer;
            
            logo.addEventListener('touchstart', (e) => {
                pressTimer = setTimeout(() => {
                    this.triggerLongPressEasterEgg();
                    // Haptic feedback
                    if (navigator.vibrate) {
                        navigator.vibrate(100);
                    }
                }, 1200);
            });
            
            logo.addEventListener('touchend', () => {
                clearTimeout(pressTimer);
            });
            
            logo.addEventListener('mousedown', (e) => {
                pressTimer = setTimeout(() => {
                    this.triggerLongPressEasterEgg();
                }, 1200);
            });
            
            logo.addEventListener('mouseup', () => {
                clearTimeout(pressTimer);
            });
        }

        triggerLongPressEasterEgg() {
            this.addMessage('âœ¨ é•·æŒ‰è§¸ç™¼ï¼ç²’å­çˆ†ç™¼æ•ˆæœï¼', false, 'success');
            this.createParticleEffect('ğŸ’«');
            this.experience += 100;
            this.updateDisplay();
        }

        setupShakeDetection() {
            if (window.DeviceMotionEvent) {
                let lastX, lastY, lastZ;
                let shakeThreshold = 13;
                
                window.addEventListener('devicemotion', (e) => {
                    const acceleration = e.accelerationIncludingGravity;
                    if (!acceleration) return;
                    
                    const curX = acceleration.x;
                    const curY = acceleration.y;
                    const curZ = acceleration.z;
                    
                    if (lastX !== undefined) {
                        const deltaX = Math.abs(lastX - curX);
                        const deltaY = Math.abs(lastY - curY);
                        const deltaZ = Math.abs(lastZ - curZ);
                        
                        if (deltaX + deltaY + deltaZ > shakeThreshold) {
                            this.triggerShakeEasterEgg();
                        }
                    }
                    
                    lastX = curX;
                    lastY = curY;
                    lastZ = curZ;
                });
            }
        }

        triggerShakeEasterEgg() {
            this.addMessage('ğŸ“± åµæ¸¬åˆ°æ–å‹•ï¼å•Ÿå‹•å¾©å¤CRTæ¿¾é¡ï¼', false, 'info');
            document.body.classList.add('crt-filter');
            setTimeout(() => {
                document.body.classList.remove('crt-filter');
            }, 3000);
        }

        setupTimeBasedEasterEggs() {
            const now = new Date();
            const hour = now.getHours();
            const minute = now.getMinutes();
            const month = now.getMonth() + 1;
            const date = now.getDate();
            
            // 3:14 AM Easter Egg
            if (hour === 3 && minute === 14) {
                this.addMessage('ğŸŒ™ å¤œè²“æ¨¡å¼å•Ÿå‹•ï¼æ·±å¤œçš„ç¥ç§˜æ™‚åˆ»...', false, 'info');
                document.querySelector('.chat-header').style.background = 'linear-gradient(45deg, #1e1b4b, #312e81)';
            }
            
            // April Fool's Day Easter Egg
            if (month === 4 && date === 1) {
                this.triggerAprilFoolsEasterEgg();
            }
        }

        triggerAprilFoolsEasterEgg() {
            this.addMessage('ğŸŸ æ„šäººç¯€å¿«æ¨‚ï¼æŒ‰éˆ•å€‘è¦èª¿çš®ä¸€ä¸‹...', false, 'success');
            const buttons = document.querySelectorAll('button');
            buttons.forEach(button => {
                if (!button.innerHTML.includes('ğŸŸ')) {
                    button.innerHTML += ' ğŸŸ';
                }
            });
            
            // Remove fish emojis after April 2nd
            setTimeout(() => {
                if (new Date().getDate() > 1) {
                    buttons.forEach(button => {
                        button.innerHTML = button.innerHTML.replace(' ğŸŸ', '');
                    });
                }
            }, 24 * 60 * 60 * 1000);
        }

        setupKeyboardCombo() {
            let ctrlPressed = false;
            let altPressed = false;
            
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey) ctrlPressed = true;
                if (e.altKey) altPressed = true;
                
                if (ctrlPressed && altPressed && e.key === 't') {
                    this.showTailwindCheatSheet();
                }
            });
            
            document.addEventListener('keyup', (e) => {
                if (!e.ctrlKey) ctrlPressed = false;
                if (!e.altKey) altPressed = false;
            });
        }

        showTailwindCheatSheet() {
            this.addMessage('ğŸ“š Tailwind CSS ç§˜ç¬ˆå·²è§£é–ï¼', false, 'info');
            const cheatSheet = `
                <div class="bg-gray-100 p-4 rounded-lg text-xs">
                    <strong>Tailwind å¸¸ç”¨é¡åˆ¥ï¼š</strong><br>
                    â€¢ é–“è·ï¼šp-4, m-2, space-y-3<br>
                    â€¢ é¡è‰²ï¼šbg-blue-500, text-red-600<br>
                    â€¢ éŸ¿æ‡‰å¼ï¼šsm:, md:, lg:, xl:<br>
                    â€¢ Flexboxï¼šflex, justify-center, items-center<br>
                    â€¢ ç¶²æ ¼ï¼šgrid, grid-cols-3, gap-4<br>
                    æŒ‰ ESC é—œé–‰
                </div>
            `;
            this.addMessage(cheatSheet, false);
        }

        setupHiddenButton() {
            const hiddenBtn = document.getElementById('easterEggBtn');
            let clickCount = 0;
            
            hiddenBtn.onclick = () => {
                clickCount++;
                if (clickCount === 1) {
                    this.addMessage('ğŸ” ä½ ç™¼ç¾äº†éš±è—æŒ‰éˆ•ï¼å†é»æ“Š2æ¬¡è§£é–ç§˜å¯†...', false, 'info');
                } else if (clickCount === 3) {
                    this.addMessage('ğŸ‰ éš±è—å½©è›‹è§£é–ï¼ç²å¾—ç¥ç§˜çå‹µï¼', false, 'success');
                    this.score += 1000;
                    this.experience += 200;
                    this.updateDisplay();
                    this.createParticleEffect('ğŸ');
                    clickCount = 0;
                }
            };
        }
    }

    // ==================== Service Worker è¨»å†Š ====================
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            const swCode = `
                const CACHE_NAME = '1a2b-game-v1';
                const urlsToCache = ['/'];
                
                self.addEventListener('install', event => {
                    event.waitUntil(
                        caches.open(CACHE_NAME)
                            .then(cache => cache.addAll(urlsToCache))
                    );
                });
                
                self.addEventListener('fetch', event => {
                    event.respondWith(
                        caches.match(event.request)
                            .then(response => response || fetch(event.request))
                    );
                });
            `;
            
            const blob = new Blob([swCode], { type: 'application/javascript' });
            const swUrl = URL.createObjectURL(blob);
            
            navigator.serviceWorker.register(swUrl)
                .then(registration => console.log('SW registered:', registration))
                .catch(error => console.log('SW registration failed:', error));
        });
    }

    // ==================== éŠæˆ²åˆå§‹åŒ– ====================
    window.addEventListener('DOMContentLoaded', () => {
        window.game = new Game1A2B();
    });

    // ==================== é˜²æ­¢ç¸®æ”¾ ====================
    document.addEventListener('gesturestart', e => e.preventDefault());
    document.addEventListener('gesturechange', e => e.preventDefault());
    document.addEventListener('gestureend', e => e.preventDefault());
</script>


</body>
</html>